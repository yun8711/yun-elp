# 发布流程和质量保证指南

## 🎯 目标

确保每次发布的版本都经过充分测试和验证，减少发布后出现的问题。

## 📋 发布前检查清单

### 自动化检查（必需）

运行以下命令确保所有检查通过：

```bash
# 发布前完整检查
pnpm pre-release

# 或分别运行
pnpm lint          # 代码规范检查
pnpm test --run    # 单元测试
pnpm build         # 构建检查
```

### 手动检查清单

- [ ] 所有测试通过（包括单元测试和集成测试）
- [ ] 代码规范检查通过（ESLint、Prettier、StyleLint）
- [ ] 构建成功，无错误或警告
- [ ] 版本号正确更新
- [ ] CHANGELOG.md 已更新
- [ ] 文档已更新并预览正常
- [ ] 破坏性变更已在文档中明确标注
- [ ] 依赖更新合理，无安全漏洞

## 🚀 发布流程

### 1. 开发阶段

```bash
# 功能开发
pnpm dev

# 运行测试
pnpm test

# 代码规范检查
pnpm lint
```

### 2. 发布准备

```bash
# 发布前完整检查
pnpm pre-release

# 如果有问题，修复后重新检查
```

### 3. 版本发布

```bash
# 创建版本标签并发布
pnpm release

# 这将：
# 1. 运行所有检查
# 2. 更新版本号
# 3. 创建Git标签
# 4. 推送到GitHub
# 5. 触发GitHub Actions自动发布到npm
```

### 4. 验证发布

发布后验证：

- [ ] npm包能正常安装：`npm install yun-elp@latest`
- [ ] 文档站点正常访问
- [ ] 示例代码正常工作
- [ ] 导入和使用正常

## 🔄 版本回退策略

### 场景1：发现严重bug需要立即回退

```bash
# 1. 立即发布修复版本
git checkout -b hotfix/v{x.y.z+1}
# 修复问题...
pnpm release --preRelease=hotfix

# 2. 通知用户使用新版本
# 在GitHub Release中说明情况
```

### 场景2：npm发布失败或需要重新发布

```bash
# 如果npm发布失败，可以手动发布
cd dist
npm publish --access public
```

### 场景3：版本号错误需要修正

```bash
# 撤销错误的标签
git tag -d v{x.y.z}
git push origin :refs/tags/v{x.y.z}

# 重新发布正确版本
pnpm release
```

## 📊 质量指标

### 测试覆盖率目标

- 单元测试覆盖率：> 80%
- 主要组件功能测试：100%
- 集成测试：关键路径覆盖

### 发布频率

- 主版本（breaking changes）：按需发布
- 次版本（新功能）：每月1次
- 补丁版本（bug修复）：按需发布

## 🐛 问题处理流程

### 发布后发现问题

1. **评估严重程度**

   - 紧急：影响生产使用
   - 一般：影响部分功能
   - 轻微：影响边缘情况

2. **处理策略**

   - 紧急：立即发布补丁版本
   - 一般：下一个补丁版本修复
   - 轻微：下一个次版本修复

3. **沟通**
   - 在GitHub Issues中记录问题
   - 更新CHANGELOG.md
   - 通知受影响用户

## 🔧 持续改进

### 定期审查

- 每月审查测试覆盖率
- 每季度审查发布流程
- 每年审查整体架构

### 自动化改进

- 增加更多自动化测试
- 改进CI/CD流程
- 添加性能监控

## 📞 联系方式

如有发布相关问题，请：

1. 查看本文档
2. 检查GitHub Issues
3. 联系维护者
